# Итераторы

С итераторами пришлось разбираться довольно долго, причем трижды переделывать их чуть более чем полностью.
И основная проблема заключалась в осознании того, что итераторы, например, в С++ это скорее указатели на данные для которых перегружены некоторые операции. Но они привязаны к своим контейнерам и для работы с итераторами требуется end(), т.е. указатель на позицию "за последним элементом".

А для NewLang такая концепция была не очень удобна, т.к. не позволяла испольовать итераторы как самостоятельные объект, хотя это очень хотелось сделать, потому что синтаксис программы получался более простой и выразительный.

Примеры создания итераторов с разными фильтрами отбора данных:
```
    iter := dict ? ("name"); # Создание итератора для значений с указанным именем
    
    iter := dict ? ("regex."); # Создание итератора для полей с префиксом regex

    filter(value) :&&= $value, $value < 10; # Чистая функция-предикат AND для фильтрации
    iter := dict ? (filter); # Создание итератора для значений меньше 10

    equal(value, arg) :- $value == arg; # Чистая функция для фильтрации
    iter := dict ? (equal, 100); # Создание итератора только для указанных значений
```

Оператор перебора элементов итератора **!** возвращает текущий элемент и сдвигает указатель на следующий. Точнее на количество считанный и возвращенных элементов, так как считывать элементы из итератора можно не только по одному, а указанными порциями.  
Если указано количество считываемых элементов **0**, то возвращается сам элемент, а если указано значение **1**, то возвращается тоже один элемент, но только как элемент словаря. Причем операторы **!** и **!(0)** **НЕ** эквивалентны, т.к. по разному обработывают конец данных.

Лучше всего это показать на примерах для словаря с пятью элементами:
```
    dict := (1,2,3,4,5,)  ?; # Итератор для словаря

    dict!; # -> 1
    dict!; # -> 2
    dict!; # -> 3
    dict!; # -> 4
    dict!; # -> 5
    dict!; # -> исключение "конец итератора"

    # Но
    dict !(0); # -> (1,)
    dict !(0); # -> (2,)
    dict !(0); # -> (3,)
    dict !(0); # -> (4,)
    dict !(0); # -> (5,)
    dict !(0); # -> (,) - пустой словарь - конец итератора
```

Так же можно указывать отрицательное количество считываемых элементов из итератора. В этом случае возвращаемый словарь всегда будет указанного размера, но элементы в словаре будут заполняться только в том случае, если данные из итератора были получены:
```
    dict := (1,2,3,4,5,)  ?; # Итератор для словаря с пятью элементами

    dict !(3); # -> (1,2,3,)
    dict !(3); # -> (4,5,)
    dict !(3); # -> (,)

    # Но
    dict !(-3); # -> (1,2,3,)
    dict !(-3); # -> (4,5, :IteratorEnd)
    dict !(-3); # -> (:IteratorEnd, :IteratorEnd, :IteratorEnd)
```

Остальные операторы для работы с итераторами сложностей вызвать не должны.
